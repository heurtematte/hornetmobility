YUI.add("hornet-ajax",function(b){var e=b.hornet,l=e.Notification,g=b.Lang,f=b.Array,i=b.Intl;var m=function(n){m.superclass.constructor.call(this,n);};b.extend(m,b.Base,{initializer:function(n){this._setAjaxConfig(n);},destructor:function(){delete this._ajaxConfig;},startHandler:function(r,q){var n=this._ajaxConfig,p=new l(q.notification);if(q.notification&&q.notification.resetNotifications){p.reset();}try{if(n&&n.on&&n.on.start){n.on.start.apply(n.context||b,arguments);}}catch(o){p.writeErrors([this._getMessage("errorOnStart")]);}},successHandler:function(n,q,s){var x=this._ajaxConfig,p=new l(s.notification),o=false,u=false,w=[],r=[],v=null;v=this._parseAjaxResponse(q);if(!v||v.error){o=true;w.push(this._getMessage("errorParsingData"));}else{r=v.messages;p.writeInfos(r);w=v.errors||[];if(w.length>0){o=true;}else{u=true;try{if(x&&x.on&&x.on.success){u=!!(x.on.success.apply(x.context||b,arguments));}}catch(t){o=true;u=false;w.push(this._getMessage("errorOnSucces"));}if(u){if(s.notification.alertOnSuccess){alert(s.notification.alertOnSuccess);}if(s.notification.msgOnSuccess){p.writeInfos([s.notification.msgOnSuccess]);}}}}if(o){if(s.notification.alertOnError){alert(s.notification.alertOnError);}if(s.notification.msgOnError){p.writeErrors([s.notification.msgOnError]);}try{if(x&&x.on&&x.on.failure){x.on.failure.apply(x.context||b,arguments);}}catch(t){w.push(this._getMessage("errorOnFailure"));}p.writeErrors(w);}},failureHandler:function(s,n,r){var o=this._ajaxConfig,q=new l(r.notification);if(r.notification.alertOnError){alert(r.notification.alertOnError);}if(r.notification.msgOnError){q.writeErrors([r.notification.msgOnError]);}try{if(o&&o.on&&o.on.failure){o.on.failure.apply(o.context||b,arguments);}}catch(p){q.writeErrors([this._getMessage("errorOnFailure")]);}},endHandler:function(r,q){var n=this._ajaxConfig,p=new l(q.notification);try{if(n&&n.on&&n.on.end){n.on.end.apply(n.context||b,arguments);}}catch(o){p.writeErrors([this._getMessage("errorOnEnd")]);}},sendRequest:function(r){var s=this.get("io"),o=this._ajaxConfig,q=o.url,p=(o.on||{}),n=b.merge(o,{on:b.merge(p,{success:b.bind(this.successHandler,this),failure:b.bind(this.failureHandler,this),start:b.bind(this.startHandler,this),end:b.bind(this.endHandler,this)}),"arguments":b.merge(o["arguments"],{notification:o.notification})});n.data=r;return s(q,n);},parseAjaxResponse:function(n){var o={error:false,result:null,errors:[],messages:[]};if(g.isUndefined(n)){o.error=true;}return o;},_getMessage:function(o){var n=this.get("strings"),p;if(n){p=n[o];}return p;},_setAjaxConfig:function(n){this._ajaxConfig=m.InitAJAXConfig(n);}},{NAME:"hornetAjax",ATTRS:{ajaxConfig:{value:{},setter:"_setAjaxConfig"},io:{valueFn:function(){return m.IO;},cloneDefaultValue:false},strings:{valueFn:function(){return b.Intl.get("hornet-ajax");}}}});b.mix(m,{InitAJAXConfig:function(p){p=p||{};var r,q={method:"POST",on:{}},o={resetNotifications:true,focusNotifications:true,zoneInfo:".infoBox",zoneError:".errorBox"},n=b.merge(q,p,{notification:b.merge(o,p.notification)});if(p.form&&!(p.form.id)){n.form={id:p.form};}r=["focusNotifications","resetNotifications","zoneInfo","zoneError","titleInfo","titleError","msgOnSuccess","msgOnError","alertOnSuccess","alertOnError"];b.mix(n.notification,p,true,r);f.each(r,function(s){delete n[s];});b.mix(n.on,{success:p.onSuccess,failure:p.onFailure});delete n.onSuccess;delete n.onFailure;return n;},IO:function(r,o){var q=(o.on||{}),n,s,p;if(o.form&&o.form.id){p=m.GetSubmitButtons(o.form.id);}if(p){n=q.start;s=q.end;o=b.merge(o,{on:b.merge(q,{start:function(u,t){p.set("disabled",true);if(n){n.apply(o.context||b,arguments);}},end:function(u,t){p.set("disabled",false);if(s){s.apply(o.context||b,arguments);}}})});}return b.io(r,o);},GetSubmitButtons:function(o){var n=null,q,p;if(o){q=(typeof o==="string")?o:o.getAttribute("id");p=b.one('form[id="'+q+'"]');}if(p){n=p.all('[type="submit"],[type="image"]').filter(":not([disabled])");}return n;}});b.namespace("hornet").Ajax=m;var c=b.namespace("hornet").Ajax,f=b.Array,d=b.DataSchema,h={NAME:"hornet-ajax-xml",parseResponseXML:function(w){var u=false,x={error:false,result:null,errors:[],messages:[]},y=null,q=null,s=null,r={metaFields:{resultat:"//RESULTAT"},resultListLocator:"error",resultFields:[{key:"key"},{key:"value"}]},n={resultListLocator:"message",resultFields:[{key:"key"},{key:"value"}]};try{y=w;q=d.XML.apply(r,y);s=d.XML.apply(n,y);}catch(p){}if(!q||!s){u=true;}else{x.result=q.meta.resultat;x.errors=[];var v,o,t;for(t=0;t<q.results.length;t++){v=q.results[t];o=(v.key)?'<a href="#'+v.key+'" >'+v.value+"</a>":v.value;x.errors[t]=o;}x.messages=[];for(t=0;t<s.results.length;t++){v=s.results[t];o=(v.key)?'<a href="#'+v.key+'" >'+v.value+"</a>":v.value;x.messages[t]=o;}}if(u){x.error=true;}else{}return x;},submitAJAXRequest:function(p,n){var o=new c(n);o._parseAjaxResponse=function(q){var r=q&&q.responseXML,s=h.parseResponseXML(r);return s;};return o.sendRequest.apply(o,[p]);}};b.namespace("hornet").AjaxXml=h;b.mix(c,h);var c=b.namespace("hornet").Ajax,a=b.YUI2,k=a.util.Connect,j={NAME:"hornet-ajax-util",parsedResponseCache:function(o){var n={error:false,result:null,errors:[],messages:[]};try{if(o.error){n.error=true;}else{n.result=o.meta.resultat;n.errors=o.meta.errors||[];n.messages=o.meta.messages||[];}}catch(p){n.error=true;}return n;},checkAuthAJAXRequest:function(p,n){n=n||window.location.href;function o(q,t){var r=true;if(q==200){if(t!==undefined&&(t.search('action="j_security_check"')>0)){if(window.confirm(p)){window.location.href=n;}else{r=false;}}}else{if(q==401||q==0){if(window.confirm(p)){var s=n.search("/?ticket=|&ticket=/i");if(s>0){n=n.substr(0,s-1);}window.location.href=n;}}}return r;}b.on("io:complete",function(q,r){if(!o(r.status,r.responseText)){r.abort();}});k.successEvent.subscribe(function(r,q){if(!o(q[0].status,q[0].responseText)){k.abort(q[0]);}});k.failureEvent.subscribe(function(r,q){if(!o(q[0].status,q[0].responseText)){k.abort(q[0]);}});}};b.namespace("hornet").AjaxUtil=j;
b.mix(c,j);},"3.3.0",{requires:["base-base","node-base","selector-css3","io-base","io-form","yui2-connection","dataschema-xml","hornet-notification"],lang:["fr"]});
