<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="secteur">

    <resultMap class="fr.gouv.diplomatie.applitutoriel.business.bo.Secteur"
        id="mapSecteur">
        <result column="ID_SECTEUR" property="id" />
        <result column="SEC_NOM" property="nom" />
        <result column="SEC_DESCR" property="desc" />
        <result column="SEC_DATE_CREAT" property="dateCreat" />
        <result column="SEC_AUTEUR_CREAT" property="auteurCreat" />
        <result column="SEC_DATE_MAJ" property="dateMajEnreg" />
        <result column="SEC_AUTEUR_MAJ" property="auteurMajEnreg" />
        <result column="SEC_DATE_SUPPR" property="dateSupprEnreg" />
        <result column="SEC_AUTEUR_SUPPR" property="auteurSupprEnreg" />
    </resultMap>

    <sql id="select_fragment">
        SELECT ID_SECTEUR, SEC_NOM, SEC_DESCR, SEC_DATE_CREAT, SEC_AUTEUR_CREAT, SEC_DATE_MAJ, SEC_AUTEUR_MAJ, SEC_DATE_SUPPR, SEC_AUTEUR_SUPPR
        FROM SECTEUR 
    </sql>
    
    <select id="select" resultMap="mapSecteur">
        <include refid="select_fragment" />
        WHERE SEC_DATE_SUPPR IS NULL 
        ORDER BY SEC_NOM ASC;
    </select>
    
    <select id="selectById" resultMap="mapSecteur">
        <include refid="select_fragment" />
        WHERE ID_SECTEUR = #id#;
    </select>
    
    <select id="selectByIdAndAuteur" resultMap="mapSecteur">
        <include refid="select_fragment" />
        WHERE ID_SECTEUR = #id# AND SEC_AUTEUR_CREAT = #auteur#;
    </select>

    <insert id="insert" parameterClass="fr.gouv.diplomatie.applitutoriel.business.bo.Secteur">
        INSERT INTO SECTEUR (
            SEC_NOM,
            SEC_DESCR,
            SEC_DATE_CREAT,
            SEC_AUTEUR_CREAT,
            SEC_DATE_MAJ, 
            SEC_AUTEUR_MAJ
        ) VALUES (
            #nom#,
            #desc#, 
            #dateCreat#, 
            #auteurCreat#, 
            #dateMajEnreg#, 
            #auteurMajEnreg#
        );
        <selectKey keyProperty="id" resultClass="decimal">
            call IDENTITY()
        </selectKey>
    </insert>
    
    <update id="update" parameterClass="fr.gouv.diplomatie.applitutoriel.business.bo.Secteur">
        UPDATE SECTEUR set SEC_NOM = #nom#, SEC_DESCR = #desc#, SEC_DATE_MAJ = #dateMajEnreg#, SEC_AUTEUR_MAJ = #auteurMajEnreg#, SEC_DATE_SUPPR = #dateSupprEnreg#, SEC_AUTEUR_SUPPR = #auteurSupprEnreg# WHERE ID_SECTEUR = #id#
    </update>
    
    <select id="selectByNomAndDescExceptForId" resultMap="mapSecteur">
        <include refid="select_fragment" />
        WHERE SEC_DATE_SUPPR IS NULL 
        <dynamic>
            <isNotEmpty property="nom" prepend="and">
                UPPER(SEC_NOM) LIKE UPPER(#nom#)
            </isNotEmpty>
            <isNotEmpty property="desc" prepend="and">
                UPPER(SEC_DESCR) LIKE UPPER(#desc#)
            </isNotEmpty>
            <isNotEmpty property="id" prepend="and">
                ID_SECTEUR != #id#
            </isNotEmpty>
        </dynamic>
    </select>
</sqlMap>